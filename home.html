<!DOCTYPE html>
<html>

<head>
    <title>Casual Discussion Friday</title>
    <meta http_equiv="content-type" content="text/html" ; charset=utf-8>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" integrity="sha384-XdYbMnZ/QjLh6iI4ogqCTaIjrFk87ip+ekIjefZch0Y+PvJ8CDYtEs1ipDmPorQ+" crossorigin="anonymous">
</head>


<body>
	<!-- SCRIPTS -->
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
	<script src="/socket.io/socket.io.js" type="text/javascript"></script>
	<script type="text/javascript">
		$(function() {
			var socket = io();
			// kill me
			const tmpl = '<li class="comment list-group-item" id="{{COMMENT_ID}}"><h5><a href="{{COMMENT_LINK}}" target="_blank">{{COMMENT_AUTHOR}}</a><small> <a href="#{{PARENT}}">replied to {{PARENT}}</a></small></h5><div class="row"><div class="col-xs-11">{{COMMENT_BODY}}</div><div class="col-xs-1"><a href="{{COMMENT_LINK}}" target="_blank"><h2 class="text-center"><i class="fa fa-angle-right"></i></h2></a></div></div><ul class="list-group" id="{{COMMENT_ID}}-replies"></ul></li>';
			const parents = $('#parent-comments');

			socket.on('comment', obj => {
                console.log(obj.author + ":");
				console.log(obj.body);
                console.log('---------------------');
				if ($('#'+obj.parent).length == 0) {
					parents.prepend(tmpl
						.replace(/{{COMMENT_ID}}/g, obj.id)
						.replace(/{{COMMENT_LINK}}/g, obj.permalink)
						.replace(/{{COMMENT_AUTHOR}}/g, obj.author)
						.replace(/{{PARENT}}/g, obj.parent)
						.replace(/{{COMMENT_BODY}}/g, obj.body_html)
					);
				} else {
					$('#'+obj.parent+'-replies').prepend(tmpl
						.replace(/{{COMMENT_ID}}/g, obj.id)
						.replace(/{{COMMENT_LINK}}/g, obj.permalink)
						.replace(/{{COMMENT_AUTHOR}}/g, obj.author)
						.replace(/{{PARENT}}/g, obj.parent)
						.replace(/{{COMMENT_BODY}}/g, obj.body_html)
					);
				}
    		}); 
		})

	</script>

    <div id="content" class="container">
        <div class="title">
            <h2 class="text-center">Casual Discussion Friday</h3>
        </div>

        <hr/>

        <ul id="parent-comments" class="list-group list-group-flush">
 
        </ul>
    </div>
</body>

</html>
